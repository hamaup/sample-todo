# CI/CD Development Workflow

## 基本原則
**重要**: CIが通るまでプルリクエストは完了とみなさない

## 開発サイクル

### 1. 実装前チェック
```bash
# 全テスト実行
npm test

# カバレッジチェック (80%以上必須)
npm run test:coverage
```

### 2. 実装 → コミット → プッシュ
```bash
# 実装作業

# ステージング
git add .

# コミット
git commit -m "descriptive commit message"

# プッシュ
git push
```

### 3. CI監視
```bash
# CI状況確認
gh pr checks <PR番号>

# 失敗時の詳細ログ確認
gh run view <run-id> --log-failed

# リアルタイム監視
gh pr checks <PR番号> --watch
```

### 4. CI失敗時の対処フロー
1. **ローカルで再現**:
   ```bash
   npm test
   npm run test:coverage
   ```

2. **問題の特定**:
   - テスト失敗: テストコードまたは実装の修正
   - カバレッジ不足: 追加テストケースの実装
   - Linter エラー: コードスタイルの修正

3. **修正 → 検証**:
   ```bash
   # 修正後のローカルテスト
   npm test
   npm run test:coverage
   
   # 問題なければコミット・プッシュ
   git add .
   git commit -m "fix: resolve CI issues"
   git push
   ```

4. **再度CI確認**:
   ```bash
   gh pr checks <PR番号>
   ```

5. **✅ 全チェック成功まで 1-4 を繰り返し**

## 必須チェック項目

### プッシュ前
- [ ] `npm test` 全テストパス
- [ ] `npm run test:coverage` 80%以上
- [ ] Linter/Formatter チェック

### プッシュ後
- [ ] CI全チェック成功
- [ ] カバレッジ閾値クリア
- [ ] 既存機能への影響なし

## 禁止事項

- ❌ CI失敗状態でのPRマージ
- ❌ カバレッジ80%未満でのプッシュ
- ❌ テスト実行なしでのコミット
- ❌ CI確認なしでのPR作成

## トラブルシューティング

### よくある失敗パターン

1. **カバレッジ不足**:
   - エッジケースのテスト追加
   - エラーハンドリングのテスト追加
   - 条件分岐の全パターンテスト

2. **テスト環境の問題**:
   - API モックの設定確認
   - DOM操作のテスト環境対応
   - 非同期処理のタイミング調整

3. **依存関係の問題**:
   - Node.js バージョン確認
   - 依存パッケージの更新
   - テスト用ライブラリの設定確認

## ベストプラクティス

- **小さなコミット**: 1つの機能・修正につき1コミット
- **説明的なコミットメッセージ**: 変更内容が明確にわかる
- **CI の早期確認**: プッシュ後すぐにCI状況をチェック
- **継続的な改善**: CI失敗の原因を記録し、再発防止策を検討